/*
 Galleria Fullscreen Theme 2011-02-23
 http://galleria.aino.se

 Copyright (c) 2011, Aino
 Licensed under the MIT license.
*/
(function (b) {
    Galleria.addTheme({
        name: "fullscreen",
        author: "Galleria",
        css: "galleria.fullscreen.css",
        defaults: {
            transition: "fade",
            imageCrop: true,
            thumbCrop: "height",
            easing: "galleriaOut",
            _hideDock: false,
            _closeOnClick: false
        },
        init: function (e) {
            this.addElement("thumbnails-tab");
            this.appendChild("thumbnails-container", "thumbnails-tab");
            var d = this.$("thumbnails-tab"),
                i = this.$("loader"),
                f = this.$("thumbnails-container"),
                h = this.$("thumbnails-list"),
                l = this.$("info-text"),
                j = this.$("info"),
                c = !e._hideDock,
                g = 0;
            if (Galleria.IE) {
                this.addElement("iefix");
                this.appendChild("container", "iefix");
                this.$("iefix").css({
                    zIndex: 3,
                    position: "absolute",
                    backgroundColor: "#000",
                    opacity: 0.4,
                    top: 0
                })
            }
            e.thumbnails === false && f.hide();
            var k = this.proxy(function (a) {
                if (a || a.width) {
                    a = Math.min(a.width, b(window).width());
                    //l.width(a - 40);
                    Galleria.IE && this.getOptions("showInfo") && this.$("iefix").width(j.outerWidth()).height(j.outerHeight())
                }
            });
            this.bind("rescale", function () {
                g = this.getStageHeight() - d.height() - 2;
                //f.css("top", c ? g - h.outerHeight() + 2 : g);
                var a = this.getActiveImage();
                a && k(a)
            });
            this.bind("loadstart", function (a) {
                a.cached || i.show().fadeTo(100, 1);
                b(a.thumbTarget).css("opacity", 1).parent().siblings().children().css("opacity", 0.6)
            });
            this.bind("loadfinish", function () {
                i.fadeOut(300);
                this.$("info, iefix").toggle(this.hasInfo());
            });
            this.bind("image", function (a) {
                k(a.imageTarget)
            });
            this.bind("thumbnail", function (a) {
                b(a.thumbTarget).parent(":not(.active)").children().css("opacity", 0.6);
                b(a.thumbTarget).click(function () {
                    c && e._closeOnClick && d.click()
                })
            });
            this.trigger("rescale");
            this.addIdleState(f, {
                //opacity: 0
            });
            this.addIdleState(this.get("info"), {
                //opacity: 0
            });
            Galleria.IE && this.addIdleState(this.get("iefix"), {
                opacity: 0
            });
            this.$("image-nav-left, image-nav-right").css("opacity", 1).show();
            if (e._hideDock) d.click(this.proxy(function () {
                d.toggleClass("open", !c);
                c ? f.animate({
                    top: g
                }, 400, e.easing) : f.animate({
                    top: g - h.outerHeight() + 2
                }, 400, e.easing);
                c = !c
            }));
            else {
                this.bind("thumbnail", function () {
				
                    //f.css("top", 150);
                    f.find(".galleria-thumbnails").css("width", "");
                    f.find(".galleria-thumbnails").css("height", "");
					
					var thumb_width = 20;
					var thumb_height = 20;
					f.find(".galleria-thumbnails img").css({"width":thumb_width,"height":thumb_height});
					f.find(".galleria-thumbnails img").attr("width", thumb_width);
					f.find(".galleria-thumbnails img").attr("height", thumb_height);
					f.find(".galleria-thumbnails .galleria-image").css({"width":thumb_width,"height":thumb_height});
									
					//var header_height = jQuery('#header').height();
					//var right_height = jQuery('.right').height();
					var thumbnails_block_height = f.height();
					var info_block_height= jQuery('.buttons').css('bottom');	
					f.css("bottom", parseInt(info_block_height)*1 + parseInt(thumbnails_block_height)*1 + 20);
	
                });
                d.css("visibility", "hidden");

            }
			
			f.find(".galleria-thumbnails .galleria-image").each(function(){
			
				var next_img_src = jQuery( 'img[src*="next_case_link"]', jQuery(this) ).attr('src');
				var prev_img_src = jQuery( 'img[src*="prev_case_link"]', jQuery(this) ).attr('src');
				var home_img_src = jQuery( 'img[src*="home_case_link"]', jQuery(this) ).attr('src');
				
				if(next_img_src || prev_img_src || home_img_src)
					jQuery('img',this).parent().hide();
				
			});
		
			
			
			h.removeAttr("width");
			//$(".galleria-thumbnails").removeAttr("height");
			
            this.$("thumbnails").children().hover(function () {
                b(this).not(".active").children().stop().fadeTo(100, 1)
            }, function () {
                b(this).not(".active").children().stop().fadeTo(400, 0.6)
            });
            this.enterFullscreen();
            this.attachKeyboard({
                escape: function () {
                    return false
                },
                up: function (a) {
                    c || d.click();
                    a.preventDefault()
                },
                down: function (a) {
                    c && d.click();
                    a.preventDefault()
                }
            });
        }
    })
})(jQuery);